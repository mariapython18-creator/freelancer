{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <!-- Include Navbar -->
    {% include 'navbar.html' %}
    {% block content %}

<div class="container py-5">
    <h2 class="mb-4 text-center">Pay for Job</h2>

    <div class="card p-4 shadow-sm">
        <h4>Job Title: {{ job.job_name }}</h4>
        <p><strong>Description:</strong> {{ job.description }}</p>
        <p><strong>Freelancer:</strong> {{ submission.Applicant_name.username }}</p>

        <p><strong>Amount:</strong> â‚¹{{ amount }}</p>

        {% if order_id %}
            <!-- Razorpay payment section -->
            <button id="rzp-button1" class="btn btn-primary">Pay with Razorpay</button>

            <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
            <script>
                var options = {
                    "key": "{{ razorpay_key }}",
                    "amount": "{{ amount|floatformat:0 }}",  // Already in paise
                    "currency": "INR",
                    "name": "Freelance Marketplace",
                    "description": "Payment for {{ submission.Applicant_name.username  }}",
                    "order_id": "{{ order_id }}",
                    "handler": function (response) {
                        alert("Payment successful! Payment ID: " + response.razorpay_payment_id);
                        window.location.href = "{% url 'client:payment_success' %}";
                    },
                    "prefill": {
                        "name": "{{ request.user.get_full_name }}",
                        "email": "{{ request.user.email }}"
                    },
                    "theme": { "color": "#3399cc" }
                };
                var rzp1 = new Razorpay(options);
                document.getElementById('rzp-button1').onclick = function (e) {
                    rzp1.open();
                    e.preventDefault();
                }
            </script>
        {% else %}
            <!-- Generate order -->
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="submission_id" value="{{ submission.id }}">
                <button type="submit" class="btn btn-success">Generate Payment</button>
            </form>
        {% endif %}
    </div>
</div>

{% endblock %}
